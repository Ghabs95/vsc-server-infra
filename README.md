# VSC Server Infrastructure

This repository contains the Terraform configuration for deploying a VSC (Visual Studio Code) server on Oracle Cloud
Infrastructure (OCI) using Ampere A1 Compute instances.

## Credits

This project leverages the [terraform-oci-ampere-a1](https://github.com/AmpereComputing/terraform-oci-ampere-a1) module.

## Prerequisites

- OCI Account
- Terraform installed
- SSH key pair (generated by Terraform)

## Usage

1. Initialize Terraform:
    ```bash
    terraform init
    ```

2. Configure your variables in `terraform.tfvars`:
   ```hcl
   tenancy_ocid     = "ocid1.tenancy.oc1..xxxx"
   user_ocid        = "ocid1.user.oc1..xxxx"
   fingerprint      = "xx:xx:xx..."
   private_key_path = "./oci-id_rsa"
   region           = "eu-milan-1"
   ```

3. Deploy the infrastructure:
    ```bash
    terraform apply
    ```

## Security Configuration

### Webhook Firewall Rules (Port 8081)

The Terraform configuration automatically restricts incoming traffic to port 8081 (Nexus webhook server) to:

- **GitHub webhook IP ranges** (from https://api.github.com/meta):
  - IPv4: 192.30.252.0/22, 185.199.108.0/22, 140.82.112.0/20, 143.55.64.0/20
  - IPv6: 2a0a:a440::/29, 2606:50c0::/32
- **Your verification IP** (temporary: 95.248.208.163/32)

These rules are defined in `main.tf` under `locals.webhook_allowed_cidrs` and applied via `for_each` in the NSG security rules.

**To modify allowed IPs:**
1. Edit `main.tf` â†’ `locals.webhook_allowed_cidrs`
2. Run `terraform plan` to preview changes
3. Run `terraform apply` to update NSG rules

Additionally, the VM itself has host-level iptables rules (see [nexus/docs/RESTORE.md](../nexus/docs/RESTORE.md#part-4-firewall-security-host-level) for details).

## Installed Software

The instance is automatically provisioned with the following tools to support the BIOME, CASE ITALIA, and WALLIBLE agent
ecosystems:

- **Docker & Docker Compose** - [https://docs.docker.com/install/](https://docs.docker.com/install/)
- **Node.js 22** - [https://nodejs.org/](https://nodejs.org/)
- **Java 17 (OpenJDK)** - [https://openjdk.org/projects/jdk/17/](https://openjdk.org/projects/jdk/17/)
- **Python 3 & pip** - [https://www.python.org/](https://www.python.org/)
- **Terraform** - [https://www.terraform.io/](https://www.terraform.io/)
- **Nginx** - [https://nginx.org/](https://nginx.org/)
- **VS Code Server (CLI)** - [https://github.com/coder/code-server](https://github.com/coder/code-server)
- **GitHub CLI (gh)** - [https://cli.github.com/](https://cli.github.com/)
- **GitHub Copilot CLI** - [https://github.com/github/copilot-cli](https://github.com/github/copilot-cli)
- **Gemini CLI** - [https://geminicli.com/](https://geminicli.com/)

## Helper Scripts

The following scripts are available in `/home/ubuntu/`:

- `setup_flutter.sh`: Installs Flutter (stable channel) and adds it to PATH. Run this if mobile development is needed.
- `start_tunnel.sh`: Starts the VS Code Server tunnel. Usage: `./start_tunnel.sh [machine_name]`. Requires interactive
  GitHub login.
- `generate_ssh_key.sh`: Generates an SSH key named `ghabs-hq` and provides instructions to add it to GitHub.

## License

Refer to the license of the upstream [Ampere OCI module](https://github.com/AmpereComputing/terraform-oci-ampere-a1).
